@model HospitalSystem.Models.Appointment

@{
    ViewBag.Title = "Edit";
}

@if (User.IsInRole("Patient"))
{
    @Html.Partial("~/Views/Patients/Header.cshtml");
}
else
{
    @Html.Partial("~/Views/Doctors/Header.cshtml");
}

<section id="randevu-al-container">
    <h2 class="container-header">Edit Appointment</h2>
    <div class="randevu-al">
        @using (Html.BeginForm())
        {
            @Html.AntiForgeryToken()
            @Html.ValidationSummary(true, "", new { @class = "text-danger" })
            @Html.HiddenFor(model => model.Id)

            @Html.HiddenFor(model => model.Patient_ID)
            if (User.IsInRole("Patient"))
            {
                <div class="form-group">
                    <!--HASTANIN GÖRECEĞİ KISIM-->
                    <label for="doktor-id">Doctor Name</label>
                    @Html.DropDownList("Doctor_ID", null, new
               {
                   @class = "form-control"
               })
                    @Html.ValidationMessageFor(model => model.Doctor_ID, "", new { @class = "text-danger" })
                </div>
            }



            if (User.IsInRole("Doctor"))
            {
                @Html.HiddenFor(model => model.Doctor_ID)
                <div class="form-group">
                    <!--DOKTORUN GÖRECEĞİ KISIM-->
                    <label for="doktor-id">Patient:</label>
                    @Html.Label((string)ViewBag.Patient_Name)
                    @Html.ValidationMessageFor(model => model.Patient_ID, "", new { @class = "text-danger" })
                    <a href="/Patients/Details/@Model.Patient_ID" class="getDetails">Get Details</a>
                </div>
            }
            <div class="form-group">
                <label for="randevu-tarihi">Randevu Tarihi</label>
                @Html.TextBoxFor(model => model.AppointmentDate, "{0:yyyy-MM-ddTHH:mm:ss}", new
           {
               @class = "form-control",
               required = "required",
               @type = "datetime-local",
               @min = DateTime.Now.ToString("yyyy-MM-ddT00:00")
           })
                @Html.ValidationMessageFor(model => model.AppointmentDate, "", new { @class = "text-danger" })
            </div>

            <div class="form-group">
                <label for="randevu-sebebi">Randevu Sebebi</label>
                @if (User.IsInRole("Doctor"))
                {
                    @Html.EditorFor(model => model.Description, new { htmlAttributes = new { @disabled = "true", @class = "form-control" } })
                }
                else
                {
                    @Html.EditorFor(model => model.Description)

                }
                @Html.ValidationMessageFor(model => model.Description, "", new { @class = "text-danger" })
            </div>
            <div class="form-group">
                <input id="btn" type="submit" value="Edit Appointment">
            </div>
        }
    </div>
</section>


<div id="ex1" class="modal"  >
    <section id="ozel-sayfa" style="padding:0">
        <div class="container" style="max-width:initial"> 
            <!-- role based olarak değişmeli-->
            @if (User.IsInRole(HospitalSystem.Models.MyConstants.RolePatient))
            {
                <div class="kisisel-bilgiler">
                    <h3>Doctor</h3>
                    <ul>
                        <li class="doctorNameSurname"></li>
                        <li class="doctorDept"></li>
                    </ul>
                </div>
            }
            @if (User.IsInRole(HospitalSystem.Models.MyConstants.RoleDoctor))
            {
                <div class="kisisel-bilgiler" style="width:100%">
                    <h3>Patient</h3>
                    <ul>
                        <li class="patientNameSurname"></li>
                        <li class="patientBlood"></li>
                    </ul>
                </div>
            }

        </div>
    </section>
</div>

@if (User.IsInRole(HospitalSystem.Models.MyConstants.RoleDoctor))
{
    <script>
        $('.getDetails').click(function (event) {//linke click eventi kazandırma
            event.preventDefault();
            this.blur();
            $.get(this.href, function (html) {
                
                    const patient = JSON.parse(html)
                    $('li.patientNameSurname').html('<span>Name Surname:</span> ' + patient.Name + " " + patient.Surname)
                    $('li.patientBlood').html('<span>Blood Group:</span> ' + patient.Blood_Group)
                    $('#ex1').modal();
                });


            });
         

    </script>
}
